<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>í• ì¼ ë“±ë¡ í…ŒìŠ¤íŠ¸</title>
</head>
<body>
<h2>í• ì¼ ë“±ë¡</h2>

<form id="todoForm">
    <label>í† í°: <input type="text" id="token" /></label><br><br>
    <label>ì œëª©: <input type="text" id="title" /></label><br><br>
    <label>ë‚´ìš©:<br>
        <textarea id="content" rows="5" cols="40"></textarea>
    </label><br><br>    <label>ë§ˆê°ì¼: <input type="datetime-local" id="dueAt" /></label><br><br>
    <label>ë‹´ë‹¹ì ID(ì‰¼í‘œë¡œ êµ¬ë¶„): <input type="text" id="managers" /></label><br><br>

    <label>ì²¨ë¶€ íŒŒì¼: <input type="file" id="files" multiple /></label><br><br>

    <button type="submit">ì œì¶œ</button>
</form>

<script>
    document.getElementById("todoForm").addEventListener("submit", async function (e) {
        e.preventDefault();

        const token = document.getElementById("token").value;
        const title = document.getElementById("title").value;
        const content = document.getElementById("content").value;
        const dueAt = document.getElementById("dueAt").value;
        const managersRaw = document.getElementById("managers").value;
        const managers = managersRaw.trim() === ""
            ? []
            : managersRaw
                .split(",")
                .map(v => Number(v.trim()))
                .filter(v => !isNaN(v));


        const files = document.getElementById("files").files;

        const formData = new FormData();

        const jsonPayload = {
            title,
            content,
            dueAt,
            managers
        };

        formData.append("request", new Blob([JSON.stringify(jsonPayload)], { type: "application/json" }));

        console.log("ğŸ” ìµœì¢… JSON payload:", JSON.stringify(jsonPayload));
        console.log("ğŸ” ë³€í™˜ëœ managers ë°°ì—´:", managers);


        for (let i = 0; i < files.length; i++) {
            formData.append("files", files[i]);
        }

        try {
            const response = await fetch("http://localhost:8080/admin/council/ì»´ê³µ/todo/8/create", {
                method: "POST",
                headers: {
                    "Authorization": `Bearer ${token}`,
                    "X-Council-Id": "8" // ëŒ€ì†Œë¬¸ì ì •í™•íˆ

                },
                body: formData
            });

            const result = await response.text();
            alert("ì„œë²„ ì‘ë‹µ: " + result);
        } catch (err) {
            alert("ìš”ì²­ ì‹¤íŒ¨: " + err);
        }
    });
</script>
</body>
</html>
